{{ header }}
{% include 'helium/template/common/breadcrumbs.twig' %}

<main role="main" id="checkout">
  {% if error_warning %}
  <div class="alert danger"><i class="icon-alert"></i> {{ error_warning }}
    <button type="button" class="close">&times;</button>
  </div>
  {% endif %}
  
  {{ content_top }}
	<h1>{{ heading_title }}</h1>
	

  {# TODO Change all divs to details #}
  <details aria-labelledby="title_login_or_register">
    <summary><h4 id="title_login_or_register">{{ text_checkout_option }}</h4></summary>
    <div class="collapse-login" id="collapse-login">
      {# Login or register form #}
    </div>
  </details>
    
    {% if not logged and account != 'guest' %}
      <details aria-labelledby="title_guest_checkout">
        <summary><h4 id="title_guest_checkout">{{ text_checkout_account }}</h4></summary>
        <div class="collapse-payment_address collapse-guest collapse-register" id="collapse-payment_address">
          {# payment address #}
        </div>
      </details>
    {% else %}
      <details aria-labelledby="title_payment_address">
        <summary><h4 id="title_payment_address">{{ text_checkout_payment_address }}</h4></summary>
        <div class="collapse-payment_address collapse-guest collapse-register" id="collapse-payment_address">
          {# payment address #}
        </div>
      </details>
    {% endif %}

    {% if shipping_required %}
      <details aria-labelledby="title_shipping_address">
        <summary><h4 id="title_shipping_address">{{ text_checkout_shipping_address }}</h4></summary>
        <div class="collapse-shipping_address" id="collapse-shipping_address">
          {# Shipping address #}
        </div>
      </details>

      <details aria-labelledby="title_shipping_method">
        <summary><h4 id="title_shipping_method">{{ text_checkout_shipping_method }}</h4></summary>
        <div class="collapse-shipping_method" id="collapse-shipping_method">
          {# Shipping method #}
        </div>
      </details>
    {% endif %}

    <details aria-labelledby="title_payment_method">
      <summary><h4 id="title_payment_method">{{ text_checkout_payment_method }}</h4></summary>
      <div class="collapse-payment_method" id="collapse-payment_method">
        {# Payment method #}
      </div>
    </details>

    <details aria-labelledby="title_confirm">
      <summary><h4 id="title_confirm">{{ text_checkout_confirm }}</h4></summary>
      <div class="collapse-confirm" id="collapse-checkout_confirm">
        {# Payment method #}
      </div>
    </details>
</main>
{{ content_bottom }}
{{ column_left }}
{{ column_right }}
<script type="text/javascript">

//$(document).on('change', 'input[name=\'account\']', function() {
//	if ($('#collapse-payment-address').parent().find('.panel-heading .panel-title > *').is('a')) {
//		if (this.value == 'register') {
//			$('#collapse-payment-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_account }} <i class="icon-chevron-down"></i></a>');
//		} else {
//			$('#collapse-payment-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_address }} <i class="icon-chevron-down"></i></a>');
//		}
//	} else {
//		if (this.value == 'register') {
//			$('#collapse-payment-address').parent().find('.panel-heading .panel-title').html('{{ text_checkout_account }}');
//		} else {
//			$('#collapse-payment-address').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_address }}');
//		}
//	}
//});

// Step 1
// {% if not logged %}
//   getForm('login');
// {% else %}
//   getForm('payment_address');
// {% endif %}

 // Step 2


// document.addEventListener('keydown', e => {
//   handleEnter(e)
// });
// function handleEnter(event) {
//   if (event.key==="Enter" && event.target.tagName == 'INPUT') {
//     const form = event.target.closest('form');
//     let inputs = form.querySelectorAll('input, select');
//     console.log(inputs)
//     const index = [...form].indexOf(event.target);

//     let current_input = form.elements[index]
//     if (current_input !== form.lastElementChild) {
//       const next_input = form.elements[index + 1];
//       next_input.focus();
//       event.preventDefault();
//     } else {
//       console.log('ololo');
//     }
//   }
// }

// $(document).delegate('#button-guest', 'click', function() {
// 	$.ajax({
// 		url: 'index.php?route=checkout/guest/save',
// 		type: 'post',
// 		data: $('#collapse-payment-address input[type=\'text\'], #collapse-payment-address input[type=\'date\'], #collapse-payment-address input[type=\'datetime-local\'], #collapse-payment-address input[type=\'time\'], #collapse-payment-address input[type=\'checkbox\']:checked, #collapse-payment-address input[type=\'radio\']:checked, #collapse-payment-address input[type=\'hidden\'], #collapse-payment-address textarea, #collapse-payment-address select'),
// 		dataType: 'json',
// 		beforeSend: function() {
				
// 		},
// 		success: function(json) {



// 					{% if shipping_required %}
						
// 						var shipping_address = $('#collapse-payment-address input[name=\'shipping_address\']:checked').prop('value');

// 						if (shipping_address) {
// 							$.ajax({
// 								url: 'index.php?route=checkout/shipping_method',
// 								dataType: 'html',
// 								complete: function() {
// 									{# $('#button-guest').button('reset'); #}
// 								},
// 								success: function(html) {
// 									// Add the shipping address
// 									$.ajax({
// 											url: 'index.php?route=checkout/guest_shipping',
// 											dataType: 'html',
// 											success: function(html) {
// 												$('#collapse-shipping-address .panel-body').html(html);
// 												$('#collapse-shipping-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_address }} <i class="icon-chevron-down"></i></a>');
// 											},
// 											error: function(xhr, ajaxOptions, thrownError) {
// 												alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
// 											}
// 									});

// 									$('#collapse-shipping-method .panel-body').html(html);
// 									$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_method }} <i class="icon-chevron-down"></i></a>');
// 									$('a[href=\'#collapse-shipping-method\']').trigger('click');
// 									$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
// 									$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
// 								},
// 								error: function(xhr, ajaxOptions, thrownError) {
// 										alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
// 								}
// 							});
// 						} else {
// 							$.ajax({
// 								url: 'index.php?route=checkout/guest_shipping',
// 								dataType: 'html',
// 								complete: function() {
// 										{# $('#button-guest').button('reset'); #}
// 								},
// 								success: function(html) {
// 									$('#collapse-shipping-address .panel-body').html(html);
// 									$('#collapse-shipping-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_address }} <i class="icon-chevron-down"></i></a>');
// 									$('a[href=\'#collapse-shipping-address\']').trigger('click');
// 									$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_shipping_method }}');
// 									$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
// 									$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
// 								},
// 								error: function(xhr, ajaxOptions, thrownError) {
// 									alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
// 								}
// 							});
// 						}

// 					{% else %}
// 						$.ajax({
// 							url: 'index.php?route=checkout/payment_method',
// 							dataType: 'html',
// 							complete: function() {
// 								{# $('#button-guest').button('reset'); #}
// 							},
// 							success: function(html) {
// 								$('#collapse-payment-method .panel-body').html(html);
// 								$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_method }} <i class="icon-chevron-down"></i></a>');
// 								$('a[href=\'#collapse-payment-method\']').trigger('click');
// 								$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
// 							},
// 							error: function(xhr, ajaxOptions, thrownError) {
// 									alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
// 							}
// 						});
// 					{% endif %}
				
// 			},
// 		error: function(xhr, ajaxOptions, thrownError) {
// 			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
// 		}
// 	});
// });




// $(document).delegate('#button-account', 'click', function() {
//     $.ajax({
//         url: 'index.php?route=checkout/' + $('input[name=\'account\']:checked').val(),
//         dataType: 'html',
//         success: function(html) {
//             console.log(html);
//             $('.alert-dismissible, .text-danger').remove();
// 			$('.form-group').removeClass('has-error');
// 
//             $('#collapse-payment-address .panel-body').html(html);
// 
// 			if ($('input[name=\'account\']:checked').val() == 'register') {
//                 $('#collapse-payment-address').parent().find('.panel-heading .panel-title')
//                 .html('<a href="#collapse-payment-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_account }} <i class="icon-chevron-down"></i></a>');
// 			} else {
//                 $('#collapse-payment-address').parent().find('.panel-heading .panel-title')
//                 .html('<a href="#collapse-payment-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_address }} <i class="icon-chevron-down"></i></a>');
// 			}
// 
// 			$('a[href=\'#collapse-payment-address\']').trigger('click');
//         },
//         error: function(xhr, ajaxOptions, thrownError) {
//             alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//         }
//     });
// });


// Register
// $(document).delegate('#button-register', 'click', function() {
//     $.ajax({
//         url: 'index.php?route=checkout/register/save',
//         type: 'post',
//         data: $('#collapse-payment-address input[type=\'text\'], #collapse-payment-address input[type=\'date\'], #collapse-payment-address input[type=\'datetime-local\'], #collapse-payment-address input[type=\'time\'], #collapse-payment-address input[type=\'password\'], #collapse-payment-address input[type=\'hidden\'], #collapse-payment-address input[type=\'checkbox\']:checked, #collapse-payment-address input[type=\'radio\']:checked, #collapse-payment-address textarea, #collapse-payment-address select'),
//         dataType: 'json',
//         beforeSend: function() {
// 			{# $('#button-register').button('loading'); #}
// 		},
//         success: function(json) {
//             $('.alert-dismissible, .text-danger').remove();
//             $('.form-group').removeClass('has-error');

//             if (json['redirect']) {
//                 location = json['redirect'];
//             } else if (json['error']) {
//                 {# $('#button-register').button('reset'); #}

//                 if (json['error']['warning']) {
//                     $('#collapse-payment-address .panel-body').prepend('<div role="alert" class="alert-danger"><i class="icon-alert"></i> ' + json['error']['warning'] + '<button type="button" class="close">&times;</button></div>');
//                 }

// 				for (i in json['error']) {
// 					var element = $('#input-payment-' + i.replace('_', '-'));

// 					if ($(element).parent().hasClass('input-group')) {
// 						$(element).parent().after('<span class="text-danger">' + json['error'][i] + '</div>');
// 					} else {
// 						$(element).after('<span class="text-danger">' + json['error'][i] + '</div>');
// 					}
// 				}

// 				// Highlight any found errors
// 				$('.text-danger').parent().addClass('has-error');
//             } else {
//                 {% if shipping_required %}
//                 var shipping_address = $('#collapse-payment-address input[name=\'shipping_address\']:checked').prop('value');

//                 if (shipping_address) {
//                     $.ajax({
//                         url: 'index.php?route=checkout/shipping_method',
//                         dataType: 'html',
//                         success: function(html) {
// 							// Add the shipping address
//                             $.ajax({
//                                 url: 'index.php?route=checkout/shipping_address',
//                                 dataType: 'html',
//                                 success: function(html) {
//                                     $('#collapse-shipping-address .panel-body').html(html);

// 									$('#collapse-shipping-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_address }} <i class="icon-chevron-down"></i></a>');
//                                 },
//                                 error: function(xhr, ajaxOptions, thrownError) {
//                                     alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                                 }
//                             });

// 							$('#collapse-shipping-method .panel-body').html(html);

// 							$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_method }} <i class="icon-chevron-down"></i></a>');

//    							$('a[href=\'#collapse-shipping-method\']').trigger('click');

// 							$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_shipping_method }}');
// 							$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
// 							$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
//                         },
//                         error: function(xhr, ajaxOptions, thrownError) {
//                             alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                         }
//                     });
//                 } else {
//                     $.ajax({
//                         url: 'index.php?route=checkout/shipping_address',
//                         dataType: 'html',
//                         success: function(html) {
//                             $('#collapse-shipping-address .panel-body').html(html);

// 							$('#collapse-shipping-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_address }} <i class="icon-chevron-down"></i></a>');

// 							$('a[href=\'#collapse-shipping-address\']').trigger('click');

// 							$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_shipping_method }}');
// 							$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
// 							$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
//                         },
//                         error: function(xhr, ajaxOptions, thrownError) {
//                             alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                         }
//                     });
//                 }
//                 {% else %}
//                 $.ajax({
//                     url: 'index.php?route=checkout/payment_method',
//                     dataType: 'html',
//                     success: function(html) {
//                         $('#collapse-payment-method .panel-body').html(html);

// 						$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_method }} <i class="icon-chevron-down"></i></a>');

// 						$('a[href=\'#collapse-payment-method\']').trigger('click');

// 						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
//                     },
//                     error: function(xhr, ajaxOptions, thrownError) {
//                         alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                     }
//                 });
//                 {% endif %}

//                 $.ajax({
//                     url: 'index.php?route=checkout/payment_address',
//                     dataType: 'html',
//                     complete: function() {
//                         {# $('#button-register').button('reset'); #}
//                     },
//                     success: function(html) {
//                         $('#collapse-payment-address .panel-body').html(html);

// 						$('#collapse-payment-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_address }} <i class="icon-chevron-down"></i></a>');
//                     },
//                     error: function(xhr, ajaxOptions, thrownError) {
//                         alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                     }
//                 });
//             }
//         },
//         error: function(xhr, ajaxOptions, thrownError) {
//             alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//         }
//     });
// });

// Payment Address
// $(document).delegate('#button-payment-address', 'click', function() {
//     $.ajax({
//         url: 'index.php?route=checkout/payment_address/save',
//         type: 'post',
//         data: $('#collapse-payment-address input[type=\'text\'], #collapse-payment-address input[type=\'date\'], #collapse-payment-address input[type=\'datetime-local\'], #collapse-payment-address input[type=\'time\'], #collapse-payment-address input[type=\'password\'], #collapse-payment-address input[type=\'checkbox\']:checked, #collapse-payment-address input[type=\'radio\']:checked, #collapse-payment-address input[type=\'hidden\'], #collapse-payment-address textarea, #collapse-payment-address select'),
//         dataType: 'json',
//         beforeSend: function() {
//         	{# $('#button-payment-address').button('loading'); #}
// 		    },
//         complete: function() {
// 			    {# $('#button-payment-address').button('reset'); #}
//         },
//         success: function(json) {
//           $('.alert-dismissible, .text-danger').remove();
// 			    $('.form-group').removeClass('has-error');

//           if (json['redirect']) {

//             location = json['redirect'];

//           } else if (json['error']) {

//             if (json['error']['warning']) {
//                 $('#collapse-payment-address .panel-body').prepend('<div role="alert" class="alert-warning">' + json['error']['warning'] + '<button type="button" class="close">&times;</button></div>');
//             }
//             for (i in json['error']) {
//               var element = $('#input-payment-' + i.replace('_', '-'));

//               if ($(element).parent().hasClass('input-group')) {
//                 $(element).parent().after('<span class="text-danger">' + json['error'][i] + '</div>');
//               } else {
//                 $(element).after('<span class="text-danger">' + json['error'][i] + '</div>');
//               }
//             }
//             // Highlight any found errors
//             $('.text-danger').parent().parent().addClass('has-error');

//           } else {

//             {% if shipping_required %}
//               $.ajax({
//                 url: 'index.php?route=checkout/shipping_address',
//                 dataType: 'html',
//                 success: function(html) {
//                   $('#collapse-shipping-address .panel-body').html(html);
// 						      $('#collapse-shipping-address').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-address" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_address }} <i class="icon-chevron-down"></i></a>');
// 						      $('a[href=\'#collapse-shipping-address\']').trigger('click');
//                   $('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_shipping_method }}');
//                   $('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
//                   $('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
//                 },
//                 error: function(xhr, ajaxOptions, thrownError) {
//                   alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                 }
//               })
//               .done(function() {
//                 $.ajax({
//                   url: 'index.php?route=checkout/payment_address',
//                   dataType: 'html',
//                   success: function(html) {
//                     $('#collapse-payment-address .panel-body').html(html);
//                   },
//                   error: function(xhr, ajaxOptions, thrownError) {
//                     alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                   }
//                 });
//               });
//             {% else %}
//               $.ajax({
//                 url: 'index.php?route=checkout/payment_method',
//                 dataType: 'html',
//                 success: function(html) {
//                   $('#collapse-payment-method .panel-body').html(html);
// 						      $('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_method }} <i class="icon-chevron-down"></i></a>');
// 						      $('a[href=\'#collapse-payment-method\']').trigger('click');
// 						      $('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
//                 },
//                 error: function(xhr, ajaxOptions, thrownError) {
//                     alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                 }
//               })
//               .done(function() {
//                 $.ajax({
//                   url: 'index.php?route=checkout/payment_address',
//                   dataType: 'html',
//                   success: function(html) {
//                     $('#collapse-payment-address .panel-body').html(html);
//                   },
//                   error: function(xhr, ajaxOptions, thrownError) {
//                     alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                   }
//                 });				
// 				        });
//             {% endif %}
//           }
//         },
//         error: function(xhr, ajaxOptions, thrownError) {
//             alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//         }
//     });
// });

// Shipping Address
// $(document).delegate('#button-shipping-address', 'click', function() {
//     $.ajax({
//         url: 'index.php?route=checkout/shipping_address/save',
//         type: 'post',
//         data: $('#collapse-shipping-address input[type=\'text\'], #collapse-shipping-address input[type=\'date\'], #collapse-shipping-address input[type=\'datetime-local\'], #collapse-shipping-address input[type=\'time\'], #collapse-shipping-address input[type=\'password\'], #collapse-shipping-address input[type=\'checkbox\']:checked, #collapse-shipping-address input[type=\'radio\']:checked, #collapse-shipping-address textarea, #collapse-shipping-address select'),
//         dataType: 'json',
//         beforeSend: function() {
// 			{# $('#button-shipping-address').button('loading'); #}
// 	    },
//         success: function(json) {
//             $('.alert-dismissible, .text-danger').remove();
// 			$('.form-group').removeClass('has-error');

//             if (json['redirect']) {
//                 location = json['redirect'];
//             } else if (json['error']) {
//                 {# $('#button-shipping-address').button('reset'); #}

//                 if (json['error']['warning']) {
//                     $('#collapse-shipping-address .panel-body').prepend('<div role="alert" class="alert-warning">' + json['error']['warning'] + '<button type="button" class="close">&times;</button></div>');
//                 }

// 				for (i in json['error']) {
// 					var element = $('#input-shipping-' + i.replace('_', '-'));

// 					if ($(element).parent().hasClass('input-group')) {
// 						$(element).parent().after('<span class="text-danger">' + json['error'][i] + '</div>');
// 					} else {
// 						$(element).after('<span class="text-danger">' + json['error'][i] + '</div>');
// 					}
// 				}

// 				// Highlight any found errors
// 				$('.text-danger').parent().parent().addClass('has-error');
//             } else {
//                 $.ajax({
//                     url: 'index.php?route=checkout/shipping_method',
//                     dataType: 'html',
//                     complete: function() {
//                         {# $('#button-shipping-address').button('reset'); #}
//                     },
//                     success: function(html) {
//                         $('#collapse-shipping-method .panel-body').html(html);

// 						$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_method }} <i class="icon-chevron-down"></i></a>');

// 						$('a[href=\'#collapse-shipping-method\']').trigger('click');

// 						$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
// 						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
						
//                         $.ajax({
//                             url: 'index.php?route=checkout/shipping_address',
//                             dataType: 'html',
//                             success: function(html) {
//                                 $('#collapse-shipping-address .panel-body').html(html);
//                             },
//                             error: function(xhr, ajaxOptions, thrownError) {
//                                 alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                             }
//                         });
//                     },
//                     error: function(xhr, ajaxOptions, thrownError) {
//                         alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                     }
//                 }).done(function() {
// 					$.ajax({
// 						url: 'index.php?route=checkout/payment_address',
// 						dataType: 'html',
// 						success: function(html) {
// 							$('#collapse-payment-address .panel-body').html(html);
// 						},
// 						error: function(xhr, ajaxOptions, thrownError) {
// 							alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
// 						}
// 					});
// 				});
//             }
//         },
//         error: function(xhr, ajaxOptions, thrownError) {
//             alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//         }
//     });
// });



// Guest Shipping
// $(document).delegate('#button-guest-shipping', 'click', function() {
//     $.ajax({
//         url: 'index.php?route=checkout/guest_shipping/save',
//         type: 'post',
//         data: $('#collapse-shipping-address input[type=\'text\'], #collapse-shipping-address input[type=\'date\'], #collapse-shipping-address input[type=\'datetime-local\'], #collapse-shipping-address input[type=\'time\'], #collapse-shipping-address input[type=\'password\'], #collapse-shipping-address input[type=\'checkbox\']:checked, #collapse-shipping-address input[type=\'radio\']:checked, #collapse-shipping-address textarea, #collapse-shipping-address select'),
//         dataType: 'json',
//         beforeSend: function() {
//         	{# $('#button-guest-shipping').button('loading'); #}
// 		},
//         success: function(json) {
//           $('.alert-dismissible, .text-danger').remove();
// 			    $('.form-group').removeClass('has-error');

//           if (json['redirect']) {
//               location = json['redirect'];
//           } else if (json['error']) {
//             {# $('#button-guest-shipping').button('reset'); #}

//             if (json['error']['warning']) {
//                 $('#collapse-shipping-address .panel-body').prepend('<div role="alert" class="alert-danger">' + json['error']['warning'] + '<button type="button" class="close">&times;</button></div>');
//             }

//             for (i in json['error']) {
//               var element = $('#input-shipping-' + i.replace('_', '-'));

//               if ($(element).parent().hasClass('input-group')) {
//                 $(element).parent().after('<span class="text-danger">' + json['error'][i] + '</div>');
//               } else {
//                 $(element).after('<span class="text-danger">' + json['error'][i] + '</div>');
//               }
//             }

//               // Highlight any found errors
//               $('.text-danger').parent().addClass('has-error');
//             } else {
//                 $.ajax({
//                     url: 'index.php?route=checkout/shipping_method',
//                     dataType: 'html',
//                     complete: function() {
//                         {# $('#button-guest-shipping').button('reset'); #}
//                     },
//                     success: function(html) {
//                         $('#collapse-shipping-method .panel-body').html(html);

// 						$('#collapse-shipping-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-shipping-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_shipping_method }} <i class="icon-chevron-down"></i>');

// 						$('a[href=\'#collapse-shipping-method\']').trigger('click');

// 						$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('{{ text_checkout_payment_method }}');
// 						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
//                     },
//                     error: function(xhr, ajaxOptions, thrownError) {
//                         alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                     }
//                 });
//             }
//         },
//         error: function(xhr, ajaxOptions, thrownError) {
//             alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//         }
//     });
// });

// $(document).delegate('#button-shipping-method', 'click', function() {
//     $.ajax({
//         url: 'index.php?route=checkout/shipping_method/save',
//         type: 'post',
//         data: $('#collapse-shipping-method input[type=\'radio\']:checked, #collapse-shipping-method textarea'),
//         dataType: 'json',
//         beforeSend: function() {
//         	{# $('#button-shipping-method').button('loading'); #}
// 		},
//         success: function(json) {
//             $('.alert-dismissible, .text-danger').remove();

//             if (json['redirect']) {
//                 location = json['redirect'];
//             } else if (json['error']) {
//                 {# $('#button-shipping-method').button('reset'); #}

//                 if (json['error']['warning']) {
//                     $('#collapse-shipping-method .panel-body').prepend('<div role="alert" class="alert-danger">' + json['error']['warning'] + '<button type="button" class="close">&times;</button></div>');
//                 }
//             } else {
//                 $.ajax({
//                     url: 'index.php?route=checkout/payment_method',
//                     dataType: 'html',
//                     complete: function() {
//                         {# $('#button-shipping-method').button('reset'); #}
//                     },
//                     success: function(html) {
//                         $('#collapse-payment-method .panel-body').html(html);

// 						$('#collapse-payment-method').parent().find('.panel-heading .panel-title').html('<a href="#collapse-payment-method" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_payment_method }} <i class="icon-chevron-down"></i></a>');

// 						$('a[href=\'#collapse-payment-method\']').trigger('click');

// 						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('{{ text_checkout_confirm }}');
//                     },
//                     error: function(xhr, ajaxOptions, thrownError) {
//                         alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                     }
//                 });
//             }
//         },
//         error: function(xhr, ajaxOptions, thrownError) {
//             alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//         }
//     });
// });

// $(document).delegate('#button-payment-method', 'click', function() {
//     $.ajax({
//         url: 'index.php?route=checkout/payment_method/save',
//         type: 'post',
//         data: $('#collapse-payment-method input[type=\'radio\']:checked, #collapse-payment-method input[type=\'checkbox\']:checked, #collapse-payment-method textarea'),
//         dataType: 'json',
//         beforeSend: function() {
//          	{# $('#button-payment-method').button('loading'); #}
// 		},
//         success: function(json) {
//             $('.alert-dismissible, .text-danger').remove();

//             if (json['redirect']) {
//                 location = json['redirect'];
//             } else if (json['error']) {
//                 {# $('#button-payment-method').button('reset'); #}
                
//                 if (json['error']['warning']) {
//                     $('#collapse-payment-method .panel-body').prepend('<div role="alert" class="alert-danger">' + json['error']['warning'] + '<button type="button" class="close">&times;</button></div>');
//                 }
//             } else {
//                 $.ajax({
//                     url: 'index.php?route=checkout/confirm',
//                     dataType: 'html',
//                     complete: function() {
//                         {# $('#button-payment-method').button('reset'); #}
//                     },
//                     success: function(html) {
//                         $('#collapse-checkout-confirm .panel-body').html(html);

// 						$('#collapse-checkout-confirm').parent().find('.panel-heading .panel-title').html('<a href="#collapse-checkout-confirm" data-toggle="collapse" data-parent="#accordion" class="accordion-toggle">{{ text_checkout_confirm }} <i class="icon-chevron-down"></i></a>');

// 						$('a[href=\'#collapse-checkout-confirm\']').trigger('click');
// 					},
//                     error: function(xhr, ajaxOptions, thrownError) {
//                         alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//                     }
//                 });
//             }
//         },
//         error: function(xhr, ajaxOptions, thrownError) {
//             alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
//         }
//     });
// });
</script>
{{ footer }}