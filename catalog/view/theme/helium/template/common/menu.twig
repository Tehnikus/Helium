{% if categories %}
  <button 
    type="button"
    id="main-menu-trigger"
    class="primary main-menu-trigger"
    aria-role="menu"
    aria-haspopup="menu"
    aria-label="{{ text_category }}"
    data-accordion-target="main-menu"
  >
    <div class="icon menu-icon">
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
    </div>
    <span class="hidden-md">
      {{ text_category }}
    </span>
  </button>
  <div id="main-menu" aria-haspopup="menu" class="dropdown-menu collapse">
    <div class="menu-inner">
      <div class="menu">
        {% for parent, category in categories %}
          {# {{ category | json_encode(constant('JSON_UNESCAPED_UNICODE')) }} #}
          <ul aria-role="menu" data-parent="{{ parent }}">
            {% for child in category %}
              <li {% if child.children_count > 0 %} data-category-id="{{ child.category_id }}" {%  endif %}>
                <a role="menuitem" href="{{ child.href }}">{{ child.name }}</a>
                <span class="product_count">{{child.product_count}}</span>
              </li>
            {% endfor %}
          </ul>
        {% endfor %}
      </div>
    </div>
  </div>


  {# Build recursive nested list #}
  {# Leave this for now #}
  {# <div id="main-menu" class="dropdown-menu collapse">
    <div class="menu-inner">
      <div class="menu">
        <ul class="top-level">
          {% for category_set in categories %}
            {{ _self.recursiveCategory(category_set) }}
          {% endfor %}
        </ul>
      </div>
    </div>
  </div> #}
{% endif %}


{# Build categories list recursively #}
{% macro recursiveCategory(category) %}
  <li><a class="mcn" href="{{ category.href }}">{{ category.name }}</a>&nbsp;<span class="product_count">{{category.product_count}}</span>
    {% if category.children|length %}
      <ul class="inner-level">
        {% for child in category.children %}
          {{ _self.recursiveCategory(child) }}
        {% endfor %}
      </ul>
    {% endif %}
    </li>
{% endmacro %}
